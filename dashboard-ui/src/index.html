<!doctype html>
<html ng-app>
<head>
  <meta charset="utf-8">

  <title>Dashboard UI</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <!-- jQuery -->
  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>

  <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- LeafletJS CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"
   integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=="
   crossorigin=""/>

<!-- LeafletJS JS -->
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"
   integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=="
   crossorigin=""></script>

<!-- Latest compiled and minified JavaScript (Bootstrap) -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<style>
  #mapid{
    height: 100%;

  }

  /*make page fill window*/
  html, body{
    height: 100%;
    margin: 0;
    padding: 0;
  }

  blockquote.twitter-tweet {
  	display: inline-block;
  	font-family: "Helvetica Neue", Roboto, "Segoe UI", Calibri, sans-serif;
  	font-size: 12px;
  	font-weight: bold;
  	line-height: 16px;
  	border-color: #eee #ddd #bbb;
  	border-radius: 5px;
  	border-style: solid;
  	border-width: 1px;
  	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
  	margin: 10px 5px;
  	padding: 0 16px 16px 16px;
  	max-width: 468px;
  }

  blockquote.twitter-tweet p {
  	font-size: 16px;
  	font-weight: normal;
  	line-height: 20px;
  }

  blockquote.twitter-tweet a {
  	color: inherit;
  	font-weight: normal;
  	text-decoration: none;
  	outline: 0 none;
  }

  blockquote.twitter-tweet a:hover, blockquote.twitter-tweet a:focus {
  	text-decoration: underline;
  }

  .navbar {
  	height: 10%;
  	border-bottom-right-radius: 2em;
  	border-bottom-left-radius: 2em;
  	background-color: #e1261c !important;
  	background: linear-gradient(#c0392b, #e1261c, #e1261c, #c0392b);
  	z-index: 3 !important;
    margin-bottom: 0px;
    margin-top: 0px;
  }

  li {
  	list-style-type: none;
  	margin: 25px;
  }

  img.avatar {
  	border-radius: 5px;
  	margin-top: 10px;
  	height: 50px;
  	width: 50px;
  }

  blockquote {
  	background-color: white;
  }

  .response {
  	background-color: #f2f2f2 !important;
  }
  </style>

</head>

<body onload="initMap()">

  <app-root>Loading...</app-root>


<!-- Modal -->

<div id="myModal" class="modal fade" enabled role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body">
        <button class="close pull-right pull-up" data-dismiss="modal">Close</button>
        <h2 style="text-align:center; border-bottom:1px black;">Jake Q. Mutual:</h2>
          <table style="margin-top:10px;">
            <th>
              <td></td>
              <td></td>
            </th>
            <tr>
              <td>Safety: </td>
              <td> <b><span style="color: green;">Confirmed</span></b></td>
            </tr>
            <tr>
              <td>Condition: </td>
              <td> <b><span style="color: red;">Unlivable</span></b></td>
            </tr>
          </table>
          <h3 style="text-align:center; border-bottom:1px black;">Image Upload(s):</h3>
          <style>
            .imgClass:hover{
              border: 3px red;
            }
          </style>
          <img class="imgClass" src="disaster-photo.jpg" style="width: 150px; height: 150px"/>
      </div>
    </div>
  </div>
</div>


  <!--  Navbar -->
	<!-- Static navbar -->
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
				</button>
				<a class="navbar-brand">State Farm</a>
			</div>
			<!--/.nav-collapse -->
		</div>
		<!--/.container-fluid -->
	</nav>

  <div id="mapid"></div>

  <script>
    var map;
    var marker;
    var markers = [];

    addMarker = function(value){


      var lat = value.lat;
      var long = value.long;
      var status = value.status;
      var damage = value.damage;

      var pinColor = "#FFFFFF";

      //dynamically set pin color
      switch(status){
        case "NN":
          pinColor = "#C8C8C8"
          break;
        case "NA":
          pinColor = "#3333CC"
          break;
        case "A":
          if (damage < 0.5){
            pinColor = "#33FF00";
            break;
          }
          else if(damage < 0.6){
            pinColor = "#33FF00";
            break;
          }
          else if(damage < 0.7){
            pinColor = "#ffe100";
            break;
          }
          else if(damage < 0.8){
            pinColor = "#ffb200";
            break;
          }
          else if (damage < 0.9){
            pinColor = "#FF6600";
            break;
          }
          else {
            pinColor = "#ef0202"
            break;
          }
        }

        //styles for marker icons
        var markerHtmlStyles = `
          background-color: ${pinColor || '#583470'};
          width: 2rem;
          height: 2rem;
          display: block;
          left: -0.5rem;
          top: -0.5rem;
          position: relative;
          border-radius: 3rem 3rem 0;
          transform: rotate(45deg);
          border: 1px solid #FFFFFF;`

            var icon = L.divIcon({
              iconAnchor: [0, 24],
              // labelAnchor: [0, 0],
              // popupAnchor: [0, -36],
              html: `<span style="${markerHtmlStyles}" />`
            });

            marker = L.marker([lat, long], {icon:icon});

            marker.addTo(map);

    }


    function initMap(){
      map = new L.Map('mapid');

      //create tile layer with openstreetmaps
      var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
      var osmAttrib='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
      var osm = new L.TileLayer(osmUrl, {minZoom:0, maxZoom:18, attribution:osmAttrib});

      //set map in bloomington and add OSM layer
      map.setView([40.4830406, -88.9895822], 12);
      map.addLayer(osm);

      var count = 0;

      //use JSON data to create markers on map
      $.getJSON('customer_data.json', function(data){
        $.each(data, function(index, value){

          //set an increasing delay for each set of 20 points
          var time_out = 500 * (count/20);
          setTimeout( function(){addMarker(value)}, time_out);

          // console.log("Delay");
          count++;
        })
      });

    }

  </script>

</body>
</html>
